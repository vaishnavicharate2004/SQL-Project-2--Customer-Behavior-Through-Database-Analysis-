CREATE DATABASE ONLINE_DELIVERY;
USE ONLINE_DELIVERY;

CREATE TABLE SALES(
     userid int,
	 created_date date,
	 product_id int
	 );

INSERT INTO Sales (userid, created_date, product_id) VALUES
(1, CONVERT(DATE,'19-04-2017',105), 2),
(3, CONVERT(DATE,'18-12-2019',105), 1),
(2, CONVERT(DATE,'20-07-2020',105), 3),
(1, CONVERT(DATE,'23-10-2019',105), 2),
(1, CONVERT(DATE,'19-03-2018',105), 3),
(3, CONVERT(DATE,'20-12-2016',105), 2),
(2, CONVERT(DATE,'09-11-2016',105), 1),
(1, CONVERT(DATE,'20-05-2016',105), 3),
(2, CONVERT(DATE,'24-09-2017',105), 2),
(1, CONVERT(DATE,'11-03-2017',105), 1),
(2, CONVERT(DATE,'11-03-2016',105), 1),
(1, CONVERT(DATE,'10-11-2016',105), 3),
(1, CONVERT(DATE,'07-12-2017',105), 2),
(2, CONVERT(DATE,'15-12-2016',105), 3),
(2, CONVERT(DATE,'08-11-2017',105), 2),
(2, CONVERT(DATE,'10-09-2018',105), 3),
(3, CONVERT(DATE,'01-05-2019',105), 4),
(1, CONVERT(DATE,'23-11-2018',105), 5),
(3, CONVERT(DATE,'30-06-2017',105), 6),
(1, CONVERT(DATE,'12-08-2018',105), 9),
(7, CONVERT(DATE,'19-03-2019',105), 7),
(7, CONVERT(DATE,'04-12-2017',105), 8),
(8, CONVERT(DATE,'22-09-2018',105), 9),
(8, CONVERT(DATE,'17-08-2020',105), 6),
(9, CONVERT(DATE,'12-05-2017',105), 10),
(6, CONVERT(DATE,'27-01-2014',105), 11),
(7, CONVERT(DATE,'02-04-2014',105), 7),
(7, CONVERT(DATE,'15-12-2020',105), 8),
(8, CONVERT(DATE,'08-09-2017',105), 9);

CREATE TABLE PRODUCT(
    product_id int,
	product_name varchar(50),
	price int
);
INSERT INTO Product (product_id, product_name, price) VALUES
(1, 'Dal Makani', 160),
(2, 'Shahi Panner', 170),
(3, 'Butter Chicken', 340),
(4, 'Aloo Gobi', 150),
(5, 'Chole Bhature', 100),
(6, 'Fish Curry', 380),
(7, 'Chicken Tikka', 300),
(8, 'Mutton Biryani', 450),
(9, 'Veg Pulao', 200),
(10, 'Mango Lassi', 80),
(11, 'Gulab Jamun', 100);

CREATE TABLE USER_NAME (
    user_id int,
	names varchar(50)
);
INSERT INTO User_name (user_id, Names) VALUES
(1, 'Anshul'),
(2, 'Rohan'),
(3, 'Shreya'),
(4, 'Priya'),
(5, 'Aryan'),
(6, 'Sara'),
(7, 'Sahil'),
(8, 'Tanvi'),
(9, 'Ritika'),
(10, 'Gaurav');

CREATE TABLE Users (
    userid INTEGER PRIMARY KEY,
    signup_date DATE
);

INSERT INTO Users (userid, signup_date) 
VALUES 
(1, '2014-09-02'),
(2, '2015-01-15'),
 (4, '2015-11-17'),
 (10, '2016-01-02'),
 (9, '2016-01-02'),
 (7, '2013-04-02'),
 (8, '2013-12-15'),
 (5, '2015-09-08'),
 (6, '2014-07-13');

CREATE TABLE GoldUser_Signup (
    userid INT PRIMARY KEY,
    gold_signup_date DATE
);

INSERT INTO GoldUser_Signup (userid, gold_signup_date) 
VALUES 
(1, '2014-09-02'),
(2, '2015-01-15'),
 (4, '2015-11-17'),
 (10, '2016-01-02'),
 (9, '2016-01-02'),
 (7, '2013-04-02'),
 (8, '2013-12-15'),
 (5, '2015-09-08'),
 (6, '2014-07-13');

 SELECT * FROM sales;
  SELECT * FROM product;
  SELECT * FROM user_name;
  SELECT * FROM users;
 SELECT * FROM GoldUser_Signup;

Q1. What is the total sales revenue generated by each product? 
     SELECT P.product_name, SUM(P.PRICE) AS TOTAL_REVENUE FROM PRODUCT AS P INNER JOIN SALES AS S
	 ON S.product_id = P.product_id
	 GROUP BY product_name
	 ORDER BY TOTAL_REVENUE DESC;

--Butter Chicken is the highest revenue generator at ₹2040, showing it’s the most 
--popular product.Shahi Paneer and Mutton Biryani follow, but their sales are 
--significantly lower compared to Butter Chicken.

Q2. Which 3 product has the highest sales revenue? 
     SELECT TOP 3 P.product_name, SUM(P.PRICE) AS TOTAL_REVENUE FROM PRODUCT AS P INNER JOIN SALES AS S
	 ON S.product_id = P.product_id
	 GROUP BY product_name
	 ORDER BY TOTAL_REVENUE DESC;

--Top 3 products are (1)Butter Chicken (2)Shahi Panner (3)Mutton Biryani

Q3. How many users have signed up for the service and has taken 
the gold membership? 
     SELECT COUNT(*) FROM GoldUser_Signup;

--The query shows the total number of users who signed up for the Gold membership.

Q4. What is the revenue generated from gold users? 
     SELECT sum(price) as gold_users_revenue from GoldUser_Signup
	 as g inner join SALES as s
	 on g.userid=s.userid
	 inner join product as p
	 on p.product_id=s.product_id;

 --Gold members have generated a total revenue of ₹6130,
 --showing their strong contribution to overall sales.

 Q5. What is the total revenue generated from gold users? 
     SELECT G.userid,SUM(P.price) as total_revenue from GoldUser_Signup G inner join sales S
	 ON G.userid = S.userid 
	 INNER JOIN PRODUCT p 
	 ON p.product_id =S.product_id
	 Group by G.userid
	 Order by SUM(P.price) desc
--This query returns the overall revenue generated only by gold members.
--It is useful to measure the financial impact of the loyalty program.

Q6. Which users has been a gold user for the How much of time? 
    SELECT userid,
       gold_signup_date,
       DATEDIFF(DAY, gold_signup_date, GETDATE()) AS gold_days
    FROM golduser_signup;
--This query calculates how long each user has been a gold member in days.
--It helps analyze customer loyalty duration and retention of premium users.

Q7. What is the most popular product among gold users? 
   SELECT TOP 1 p.product_name,
       COUNT(*) AS order_count
   FROM sales s
   JOIN golduser_signup g
   ON s.userid = g.userid
   JOIN product p
   ON s.product_id = p.product_id
   GROUP BY p.product_name
   ORDER BY order_count DESC

--Butter Chicken is the most popular product for all customer

Q8. What is the total sales revenue generated in each year? 
    SELECT YEAR(s.created_date) AS order_year,
       SUM(p.price) AS total_revenue
    FROM sales s
    JOIN product p
    ON s.product_id = p.product_id
    GROUP BY YEAR(s.created_date)
    ORDER BY order_year DESC;
--In 2020 high total sales revenue is generated

Q9. How has the sales revenue changed over the years? 
    WITH yearly_revenue AS
(
    SELECT YEAR(s.created_date) AS order_year,
           SUM(p.price) AS total_revenue
    FROM sales s
    JOIN product p
        ON s.product_id = p.product_id
    GROUP BY YEAR(s.created_date)
)
SELECT order_year,
       total_revenue,
       LAG(total_revenue) OVER (ORDER BY order_year) AS previous_year_revenue
FROM yearly_revenue;

--This query compares each year’s revenue with the previous year.
--It helps identify growth or decline patterns across years.

Q10. What is the average Gold-signup compare to just sign up for 
the users?
 SELECT
    100.0 * 
    (SELECT COUNT(*) FROM golduser_signup)
    /
    (SELECT COUNT(*) FROM users) AS gold_signup_percentage;
   

Q11. How many gold members users have order how many numbers of time ? 
     SELECT s.userid,
       COUNT(*) AS total_orders
     FROM sales s
     JOIN golduser_signup g
     ON s.userid = g.userid
     GROUP BY s.userid;

Q12. What is the total amount each customer spend on Online Food 
Delivery? 
	 SELECT s.userid,
       SUM(p.price) AS total_spent
     FROM sales s
     JOIN product p
     ON s.product_id = p.product_id
     GROUP BY s.userid;
--This query calculates total spending for each customer.
--It helps identify high-value customers.

Q13. What is the frequency of customer visits to the online platform? 	
	SELECT userid,
       COUNT(*) AS visit_count
    FROM sales
    GROUP BY userid;

--This query shows how many times each customer placed an order.
--It represents visit frequency and customer engagement.

Q14. What was the first order purchase by each customer ? 
    WITH cte AS
    (
    SELECT s.userid,
           s.product_id,
           s.created_date,
    ROW_NUMBER() OVER
           (
    PARTITION BY s.userid
    ORDER BY s.created_date
           ) AS rn
    FROM sales s
    )
    SELECT c.userid,
       p.product_name,
       c.created_date
   FROM cte c
   JOIN product p
   ON c.product_id = p.product_id
   WHERE rn = 1;

--First order purchased by each customer is 'Butter Chicken'

Q15. What is the most purchase item on the menu and how many 
times was it purchased by all customers? 
     SELECT TOP 1
       p.product_name,
       COUNT(*) AS purchase_count
    FROM sales s
    JOIN product p
    ON s.product_id = p.product_id
    GROUP BY p.product_name
    ORDER BY purchase_count DESC;

--'Butter Chicken is most purchased item by customers and it purchased for 6 times'

Q16. Which item was most popular for each customer ? 
WITH cte AS
(
    SELECT s.userid,
           p.product_name,
           COUNT(*) AS order_count,
           RANK() OVER
           (
               PARTITION BY s.userid
               ORDER BY COUNT(*) DESC
           ) AS rnk
    FROM sales s
    JOIN product p
        ON s.product_id = p.product_id
    GROUP BY s.userid, p.product_name
)
SELECT userid,
       product_name,
       order_count
FROM cte
WHERE rnk = 1;

Q17. What is the total orders and amount spent for each member 
before they become a member ?

      SELECT s.userid,
       COUNT(*) AS total_orders,
       SUM(p.price) AS total_amount
     FROM sales s
     JOIN golduser_signup g
    ON s.userid = g.userid
    JOIN product p
    ON s.product_id = p.product_id
    WHERE s.created_date < g.gold_signup_date
    GROUP BY s.userid;




    




    






